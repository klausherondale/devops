<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GradeTrack ‚Äî Dashboard</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=" />
<!-- Google Inter font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f1f5f9;           /* page bg */
    --panel:#ffffff;        /* card bg */
    --muted:#64748b;        /* muted text */
    --primary:#2563eb;      /* blue */
    --accent:#06b6d4;       /* teal */
    --success:#16a34a;
    --danger:#ef4444;
    --shadow: 0 8px 30px rgba(15,23,42,0.06);
    --radius:12px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:Inter,system-ui,Arial,sans-serif;
    background:linear-gradient(180deg, #f8fbff, var(--bg));
    color:#0f172a;
  }

  /* Layout */
  .app{display:flex;min-height:100vh}
  /* Sidebar */
  .sidebar{
    width:260px;background:#ffffff;border-right:1px solid rgba(15,23,42,0.04);
    padding:22px 18px;display:flex;flex-direction:column;gap:18px;
  }
  .brand{display:flex;align-items:center;gap:12px}
  .logo{
    width:44px;height:44px;border-radius:10px;background:linear-gradient(180deg,var(--primary),#1e40af);
    color:#fff;font-weight:700;display:flex;align-items:center;justify-content:center;font-size:18px;
    box-shadow: 0 6px 18px rgba(37,99,235,0.08)
  }
  .brand h1{margin:0;font-size:16px;font-weight:700}
  .nav{display:flex;flex-direction:column;gap:6px;margin-top:6px}
  .nav a{
    display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;color:#0f172a;text-decoration:none;font-weight:600;
  }
  .nav a.active{background:linear-gradient(180deg,#eef2ff,#ffffff);box-shadow:var(--shadow)}
  .nav a .icon{width:18px;text-align:center;color:var(--primary);opacity:0.95}

  .sidebar .bottom{margin-top:auto}
  .logout{color:#ef4444;font-weight:600;padding:8px 10px;border-radius:8px;display:inline-block}

  /* Main content */
  .main{flex:1;padding:20px 28px}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px}
  .search{
    flex:1;display:flex;align-items:center;gap:12px;background:var(--panel);padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);
  }
  .search input{border:0;outline:0;background:transparent;width:100%;font-size:14px}
  .profile{display:flex;align-items:center;gap:12px}
  .profile img{width:40px;height:40px;border-radius:50%}
  .profile .meta{font-size:13px;color:var(--muted)}
  .page-title{margin:12px 0 18px 0}
  .page-title h2{margin:0;font-size:26px;font-weight:700}
  .page-title p{margin:6px 0 0;color:var(--muted)}

  /* KPIs */
  .kpis{display:flex;gap:14px;margin-bottom:18px}
  .kpi{flex:1;background:var(--panel);padding:18px;border-radius:12px;box-shadow:var(--shadow);display:flex;justify-content:space-between;align-items:center}
  .kpi .left{display:flex;flex-direction:column;gap:6px}
  .kpi .muted{color:var(--muted);font-size:13px}
  .kpi strong{font-size:22px}
  .kpi .small{font-size:12px;color:#10b981}

  /* Charts & panels */
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  .card{background:var(--panel);padding:18px;border-radius:12px;box-shadow:var(--shadow)}
  .charts{display:flex;flex-direction:column;gap:14px}
  .charts .big{height:320px}
  .charts .small{height:220px}

  /* Table */
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:12px 10px;text-align:left;font-size:14px;border-bottom:1px solid #eef2f6}
  th{color:var(--muted);font-weight:600;font-size:13px}
  tbody tr:hover{background:#fbfdff}

  /* Right-side lists */
  .mini-list{display:flex;flex-direction:column;gap:10px}
  .mini-list .row{display:flex;justify-content:space-between;align-items:center}
  .badge{padding:6px 8px;border-radius:8px;font-weight:700}

  /* responsive */
  @media(max-width:1000px){
    .sidebar{display:none}
    .grid{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar" aria-label="Sidebar">
    <div class="brand">
      <div class="logo">GT</div>
      <div>
        <h1>GradeTrack</h1>
        <div style="font-size:12px;color:var(--muted)">Teacher dashboard</div>
      </div>
    </div>

    <nav class="nav" aria-label="Main Navigation">
      <a href="#" class="active"><span class="icon">üè†</span> Dashboard</a>
      <a href="#"><span class="icon">üë•</span> Students</a>
      <a href="#"><span class="icon">üìö</span> Subjects</a>
      <a href="#"><span class="icon">üìù</span> Assessments</a>
      <a href="#"><span class="icon">üìä</span> Reports</a>
      <a href="#"><span class="icon">‚öôÔ∏è</span> Settings</a>
    </nav>

    <div class="bottom">
      <a href="#" class="logout">‚§ì Logout</a>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#94a3b8" stroke-width="1.6" stroke-linecap="round"/></svg>
        <input placeholder="Search for students or subjects..." id="searchInput" />
      </div>

      <div class="profile">
        <div style="text-align:right">
          <div style="font-weight:700">Sarah Johnson</div>
          <div class="meta">Teacher</div>
        </div>
        <img src="https://i.pravatar.cc/150?img=47" alt="profile" />
      </div>
    </div>

    <div class="page-title">
      <h2>Welcome, Sarah Johnson</h2>
      <p>Here's an overview of your students' performance</p>
    </div>

    <!-- KPIs -->
    <section class="kpis">
      <div class="kpi">
        <div class="left">
          <div class="muted">Total Students</div>
          <strong id="k-total">0</strong>
          <div class="small">+12 from last month</div>
        </div>
        <div style="font-size:22px;color:var(--primary)">üë•</div>
      </div>

      <div class="kpi">
        <div class="left">
          <div class="muted">Average Grade</div>
          <strong id="k-avg">0%</strong>
          <div class="small">+2.5% from last month</div>
        </div>
        <div style="font-size:22px;color:#10b981">üìà</div>
      </div>

      <div class="kpi">
        <div class="left">
          <div class="muted">Highest Score</div>
          <strong id="k-high">0%</strong>
          <div class="small" style="color:var(--muted);font-weight:600">Emma Wilson ‚Ä¢ Math</div>
        </div>
        <div style="font-size:22px;color:#7c3aed">üèÖ</div>
      </div>

      <div class="kpi">
        <div class="left">
          <div class="muted">Lowest Score</div>
          <strong id="k-low">0%</strong>
          <div class="small" style="color:var(--muted);font-weight:600">Needs attention</div>
        </div>
        <div style="font-size:22px;color:#f97316">‚ö†Ô∏è</div>
      </div>
    </section>

    <!-- GRID: charts + right column -->
    <section class="grid">
      <!-- LEFT: charts + table -->
      <div>
        <div class="card charts">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h3 style="margin:0">Average Grades Over Time</h3>
              <div class="muted" style="font-size:13px;margin-top:6px">Monthly class average across subjects</div>
            </div>
            <div class="muted tiny">Jan - Jun</div>
          </div>
          <div class="big" style="padding-top:10px">
            <canvas id="lineChart"></canvas>
          </div>
        </div>

        <div class="card" style="margin-top:16px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0">Students</h3>
            <div style="font-size:13px;color:var(--muted)">Roll | Name | Avg% | Grade</div>
          </div>

          <table aria-label="Students table">
            <thead><tr><th>Roll</th><th>Name</th><th>Avg %</th><th>Grade</th></tr></thead>
            <tbody id="studentsTbody"></tbody>
          </table>
        </div>
      </div>

      <!-- RIGHT: grade distribution + data preview -->
      <aside>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0">Grade Distribution</h3>
            <div class="muted tiny">Current term</div>
          </div>
          <div style="height:220px;margin-top:12px">
            <canvas id="pieChart"></canvas>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 style="margin:0 0 10px 0">Data Snapshot</h3>
          <div class="mini-list">
            <div class="row"><div class="muted">Subjects</div><div id="subjectCount">0</div></div>
            <div class="row"><div class="muted">Assessments</div><div id="assessCount">0</div></div>
            <div class="row"><div class="muted">Marks</div><div id="marksCount">0</div></div>
          </div>
        </div>
      </aside>
    </section>
  </main>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/*
  Demo app behaviour:
  - creates sample data if none present
  - calculates KPIs and fills UI
  - ready to be replaced with backend fetches later
*/

const STORAGE_KEY = 'gradeTrack_v2_demo';

// sample dataset creation
function seedDemo(){
  const students = [
    {id:'s1', roll:'2117', name:'Emma Wilson'},
    {id:'s2', roll:'2118', name:'Liam Brown'},
    {id:'s3', roll:'2119', name:'Olivia Davis'},
    {id:'s4', roll:'2120', name:'Noah Miller'},
    {id:'s5', roll:'2121', name:'Ava Martinez'},
    {id:'s6', roll:'2122', name:'Sophia Lee'},
    {id:'s7', roll:'2123', name:'Mason Clark'},
    {id:'s8', roll:'2124', name:'Isabella Hall'}
  ];

  const subjects = [
    {id:'sub1', code:'MATH', name:'Mathematics'},
    {id:'sub2', code:'PHY', name:'Physics'},
    {id:'sub3', code:'ENG', name:'English'}
  ];

  const assessments = [
    {id:'a1', subjectId:'sub1', name:'Quiz 1', max:20, weight:0.1},
    {id:'a2', subjectId:'sub1', name:'Midterm', max:100, weight:0.4},
    {id:'a3', subjectId:'sub1', name:'Final', max:100, weight:0.5},
    {id:'a4', subjectId:'sub2', name:'Midterm', max:100, weight:0.5},
    {id:'a5', subjectId:'sub2', name:'Final', max:100, weight:0.5},
    {id:'a6', subjectId:'sub3', name:'Essay', max:50, weight:0.3},
    {id:'a7', subjectId:'sub3', name:'Final', max:100, weight:0.7}
  ];

  // random-ish marks per student per assessment
  const marks = [];
  students.forEach((s, idx)=>{
    assessments.forEach(a=>{
      // simulate performance cluster
      const base = 70 + (idx % 3 === 0 ? 10 : (idx % 3 === 1 ? -5 : 0));
      const variance = Math.floor(Math.random()*15) - 5;
      const val = Math.max(0, Math.round((base + variance) * (a.max/100)));
      marks.push({studentId:s.id, assessmentId:a.id, value: Math.min(a.max, val)});
    });
  });

  const data = { students, subjects, assessments, marks };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  return data;
}

function loadData(){
  const raw = localStorage.getItem(STORAGE_KEY);
  return raw ? JSON.parse(raw) : seedDemo();
}

let data = loadData();

/* Utility: compute per-student percentage (subject-weighted) */
function computeAverages(data){
  // build assessment map
  const assessMap = {}; data.assessments.forEach(a=>assessMap[a.id]=a);
  const subjMap = {}; data.subjects.forEach(s=>subjMap[s.id]=s);

  // group marks by student
  const studentAverages = {};
  data.students.forEach(s=>{
    const subjTotals = {}; // subj -> {weightedSum, weightSum}
    data.subjects.forEach(sub=>subjTotals[sub.id] = {weightedSum:0, weightSum:0});
    data.assessments.forEach(a=>{
      const mark = data.marks.find(m=>m.studentId===s.id && m.assessmentId===a.id);
      if(mark){
        const pct = (mark.value / a.max) * 100;
        subjTotals[a.subjectId].weightedSum += pct * (a.weight || 0);
        subjTotals[a.subjectId].weightSum += (a.weight || 0);
      }
    });

    // compute average across subjects (only those with weightSum>0)
    const subjectScores = [];
    for(const sid in subjTotals){
      const t = subjTotals[sid];
      if(t.weightSum > 0) subjectScores.push(t.weightedSum / t.weightSum);
    }
    const avg = subjectScores.length ? subjectScores.reduce((a,b)=>a+b,0)/subjectScores.length : 0;
    let grade='F';
    if(avg>=90) grade='A'; else if(avg>=80) grade='B'; else if(avg>=70) grade='C'; else if(avg>=60) grade='D';
    studentAverages[s.id] = {avg: Math.round(avg*10)/10, grade};
  });

  return studentAverages;
}

/* KPIs and UI fill */
function refreshUI(){
  const avgs = computeAverages(data);
  // KPIs
  const totals = Object.values(avgs).map(x=>x.avg);
  document.getElementById('k-total').textContent = data.students.length;
  document.getElementById('k-avg').textContent = totals.length ? (Math.round((totals.reduce((a,b)=>a+b,0)/totals.length)*10)/10 + '%') : '0%';
  document.getElementById('k-high').textContent = totals.length ? Math.max(...totals) + '%' : '0%';
  document.getElementById('k-low').textContent = totals.length ? Math.min(...totals) + '%' : '0%';

  // students table
  const tbody = document.getElementById('studentsTbody');
  tbody.innerHTML = '';
  data.students.forEach(s=>{
    const r = avgs[s.id] || {avg:0, grade:'F'};
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.roll}</td><td>${s.name}</td><td>${r.avg}%</td><td style="font-weight:700">${r.grade}</td>`;
    tbody.appendChild(tr);
  });

  // snapshot
  document.getElementById('subjectCount').textContent = data.subjects.length;
  document.getElementById('assessCount').textContent = data.assessments.length;
  document.getElementById('marksCount').textContent = data.marks.length;

  // charts update
  updateLineChart();
  updatePieChart();
}

/* Charts */
let lineChart=null, pieChart=null;

function updateLineChart(){
  // Make monthly demo averages Jan-Jun (simulate mild variation)
  const base = parseFloat((Math.random()*2+78).toFixed(1));
  const months = ['Jan','Feb','Mar','Apr','May','Jun'];
  const values = months.map((m,i)=> Math.round((base + (i-2.5)*1.5 + (Math.random()*2-1))*10)/10);

  const ctx = document.getElementById('lineChart').getContext('2d');
  if(lineChart) lineChart.destroy();
  lineChart = new Chart(ctx, {
    type:'line',
    data: {
      labels: months,
      datasets: [{
        label:'average',
        data: values,
        fill:false,
        tension:0.3,
        pointRadius:5,
        borderWidth:3,
        borderColor: 'rgba(37,99,235,0.95)',
        backgroundColor: 'rgba(37,99,235,0.15)'
      }]
    },
    options: {
      plugins:{legend:{display:false}},
      scales:{
        y:{min:0,max:100, ticks:{stepSize:20}}
      },
      responsive:true,
      maintainAspectRatio:false
    }
  });
}

function updatePieChart(){
  // distribution from student averages
  const avgs = computeAverages(data);
  const counts = {A:0,B:0,C:0,D:0,F:0};
  Object.values(avgs).forEach(x=>counts[x.grade]++);
  const ctx = document.getElementById('pieChart').getContext('2d');
  if(pieChart) pieChart.destroy();
  pieChart = new Chart(ctx, {
    type:'doughnut',
    data:{
      labels:['A','B','C','D','F'],
      datasets:[{data:Object.values(counts),
        backgroundColor:['#16a34a','#2563eb','#f59e0b','#f97316','#ef4444']
      }]
    },
    options:{plugins:{legend:{position:'right'}}, responsive:true, maintainAspectRatio:false}
  });
}

/* Init */
refreshUI();

// quick search (client side)
document.getElementById('searchInput').addEventListener('input', e=>{
  const q = e.target.value.toLowerCase().trim();
  const tbody = document.getElementById('studentsTbody');
  Array.from(tbody.children).forEach(tr=>{
    const text = tr.textContent.toLowerCase();
    tr.style.display = text.includes(q) ? '' : 'none';
  });
});
</script>
</body>
</html>
